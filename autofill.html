<article>

<h1>Prefill Your Own Forms With A Bookmarklet</h1>

<p class="time">
  Published
  <time datetime="2013-06-13">
    June 13, 2013
  </time>
  by Guest Author
</p>

<em class="explanation">The following is a guest post by <a href="http://adamin.net/">Adam Lichtenstein</a>. Adam works at <a href="http://www.wufoo.com/">Wufoo</a>, a web app for building web forms, so you can imagine the need for testing forms is at least double what the rest of us need. Adam took a different road than <a href="http://css-tricks.com/prefill-forms-dev/">I took</a>, so I'll let him share.</em>

<!--more-->

After reading Chris's post on <a href="http://css-tricks.com/prefill-forms-dev/">prefilling forms in dev</a>, I was inspired to add another perspective in how I've tackled this same issue.

Like a lot of developers, I quickly get tired of filling out lengthy forms on my own site.  No matter how many automated tests I might have, I still find myself visually testing the user experience.  I guess there's no better way to find a pain point than to do it a thousand times in a day.

So the way I see it, there are a few workable solutions to help prefilling your forms.

<ol>
  <li>Add dynamic code as Chris explained in his previous post</li>
  <li>Create a JavaScript bookmarklet to isolate the auto-fill code from your markup</li>
  <li>Script the auto-fill with a useful tool like <a href="http://casperjs.org/">CasperJS</a>, <a href="http://zombie.labnotes.org/">ZombieJS</a> or <a href="https://github.com/angular/protractor">ProtractorJS</a></li>
</ol>

Ultimately, I do believe the best solution is #3. Scripting allows you to programmatically set up the running of your actions.  You can make this part of your build process, hook into GitHub commits, integrate with <abbr title="Continuous Integration">CI</abbr>, add logs to a database, and tons more.

However, that solution does require quite a bit of planning and infrastructure to do correctly. In reality, it's common to be pressed for deadlines and a need to test these forms quickly and manually.  That's the situation I found myself in a couple of months ago when we were adding the British Pound to our checkout options in <a href="http://www.wufoo.com">Wufoo</a>.

So I built a JavaScript bookmarklet to help our <abbr title="Quality Assurance">QA</abbr> people and developers quickly fill in our checkout forms for testing.

If you don't have experience with them, JavaScript bookmarklets are simply snippets of JavaScript that you can embed in an anchor link, and will run on click. They are called bookmarklets because they are literally bookmarkable, meaning you can run them by selecting a bookmark, often from the "bookmarks bar" in your browser.

There are lots of tools that use this approach including: ..., ..., ... And I even recently used it to create <a href="https://seethroughtrees.github.io/nice-inline-copy-editor/">NICE: New Inline Copy Editor</a> for some of the design team on <a href="https://www.surveymonkey.com/">SurveyMonkey</a> and anyone else who wants it.

I tend to rely on JavaScript bookmarklets for a few reasons:

<ol>
  <li>They're light and easy to implement</li>
  <li>I can distribute them quickly and easily</li>
  <li>I can control the updating of the files without requiring anyone to install or update</li>
  <li>You can run them on any environment or any site  (that isn't using <a href="http://www.html5rocks.com/en/tutorials/security/content-security-policy/">Content Security Policy</a>)</li>
</ol>

Let's get into how to quickly implement a tool like this.

You can build a JavaScript bookmarklet easily by just creating a Pen on CodePen and adding this snippet into an href:

<pre rel="HTML"><code markup="tt" class="language-markup"><a href="javascript: **code** "></a></code></pre>

@todo Pen here:  http://codepen.io/seethroughtrees/pen/bjyJI/

Then your user only needs to drag that link into their bookmarks bar. Then click on it any time they want to run that code on the current page in the browser.

Lets break down what we're trying to do here <abbr title="Behavior Driven Development">BDD</abbr> style:

As a user, I want to<br>
auto-fill my form<br>
on any environment<br>
with unique data<br>
with valid and invalid entries.

This should be straightforward.

<h4>Autofill my form</h4>
This is something we can easily implement in vanilla JavaScript.  But for the sake of simplicity (and cross-browser compatibility), lets use jQuery.

<h4>On any environment</h4>
At Wufoo, for example, we have 4 different staging environments: local, dev, stage and production. We also have test pools in production. I want to be able to use this on any of them. So using a generic bookmarklet will be a great solution.

<h4>With unique data</h4>
We want to test with different email addresses, names etc. You never know what might come up when you use a variation of your data. There's a great library out there ported in most languages called <a href="https://github.com/stympy/faker">Faker</a>. We'll use <a href="https://github.com/marak/Faker.js/">the JavaScript implementation</a> here.

<h4>With valid and invalid entries</h4>
A downside of running our script with a bookmarklet is we can't pass in arguments. So we'll have to create a few different tests. Or get clever.


<h3>Building the Bookmarklet</h3>

We can easily put our code directly into the snippet.  But besides being cleaner and lintable, we want to be able to update that code without being forced to update the actual bookmarklet.  So instead, lets reference an external file.

Lets start with our snippet code:

<pre rel="HTML"><code markup="tt" class="language-markup"><a href="javascript:
(function(d) {
  var body = d.getElementsByTagName('body')[0],
      script = d.createElement('script');
      script.src = '//localhost.com/pathtomyfile.js';
      body.appendChild(script);
}(window.document));
">My Javascript Bookmarklet</a></code></pre>

@todo Pen here:  http://codepen.io/seethroughtrees/pen/HeoCd

Lets break this snippet down. We're using JavaScript to append a <code>script</code> tag to the <code>body</code>, and adding the path to our file inside. If you are testing on an https secure page, you will want to make sure your script is also https.  Otherwise some browsers will throw a security error.  Lastly, we're wrapping the whole snippet in a <a href="http://sarfraznawaz.wordpress.com/2012/01/26/javascript-self-invoking-functions/">Self Invoking Anonymous Function</a> just to keep it from affecting the rest of the code.

<em>Note: You'll probably use a localhost version of the file while you're in development and replace it with a production version when you're ready to share.</em>

<h3>The Prefilling Script</h3>

Now that we have our bookmarklet ready to load a script file of our choice.  Lets make that script file...

First lets wrap the whole thing in a <a href="#">Self Invoking Anonymous Function</a>.  That will help make sure our code doesn't pollute anything on the outside.

Its a bit boilerplate.  But basically, it just protects the variables created inside of it.  While at the same time, executes on load.

<pre rel="Javascript"><code markup="tt" class="language-javascript">

  (function(win, doc, $, undefined) {

    'use strict';

    // our code will go here

  }(window, window.document, window.jQuery));

</code></pre>

Next, lets load up FakerJS script.  Since we've decided we'll use jQuery as a dependency.  We can just use $.getScript which will return us an easy promise.

<pre rel="Javascript"><code markup="tt" class="language-javascript">
  $.getScript('//cdnjs.cloudflare.com/ajax/libs/Faker/0.7.2/MinFaker.js')
    .done(function() {
      data = new FormData(win.Faker);
      fillForm(data);
    })
    .fail(function() {
      win.console.error('ERROR: FakerJS not loaded!');
    });
</code></pre>

Instead of just creating literal data.  Lets make a <a href="#">constructor function</a> that we can reuse if necessary in the future.

<pre rel="Javascript"><code markup="tt" class="language-javascript">
  FormData = function(faker) {

    this.faker     = faker;

    this.username  = 'fake_' + faker.Internet.domainWord();
    this.username  += faker.random.number(9999);

    this.firstName = faker.Name.firstName();
    this.lastName  = faker.Name.lastName();

    this.email     = 'chriscoyier+' + this.username + '@gmail.com';

    this.phone1    = faker.Helpers.replaceSymbolWithNumber('###');
    this.phone2    = faker.Helpers.replaceSymbolWithNumber('###');
    this.phone3    = faker.Helpers.replaceSymbolWithNumber('####');

    this.address1  = faker.Address.streetAddress();
    this.address2  = faker.Address.secondaryAddress();
    this.city      = faker.Address.city();
    this.state     = faker.Address.usState();
    this.zip       = faker.Address.zipCode();

  };
</code></pre>

I'd like to automate some field types like checkboxes and select boxes etc...  So lets extend the FormData object with some functions.

<pre rel="jQuery"><code markup="tt" class="language-javascript">
  FormData.prototype.randomSelect = function(el) {
    var $el = $(el);

    len  = $el.find('option').length - 1;
    rand = Math.floor( Math.random() * len ) + 1;

    $el.children('option')
      .prop('selected', false)
      .eq( rand )
      .prop('selected', true);
  };

  FormData.prototype.randomRadio = function(radios) {
    radios = radios.not('[type="hidden"]');
    len    = radios.length;
    rand   = Math.floor( Math.random() * len );

    radios
      .prop('checked', false)
      .eq( rand )
      .prop('checked', true);
  };

  FormData.prototype.randomParagraph = function(el) {
    $(el).val(this.faker.Lorem.paragraph());
  };

  FormData.prototype.randomCheckbox = function(el) {
    rand = Math.floor( Math.random() * 2 ),
    $el  = $(el);

    $el.prop('checked', false);

    if (rand === 0) {
      $el.prop('checked', true);
    }
  };
</code></pre>

And last, we just need to bind the data to the fields on our form.

<pre rel="jQuery"><code markup="tt" class="language-javascript">
  fillForm = function(data) {

    $('#Field17').val(data.username);
    $('#Field2').val(data.firstName);
    $('#Field3').val(data.lastName);
    $('#Field10').val(data.email);
    $('#Field11').val(data.phone1);
    $('#Field11-1').val(data.phone2);
    $('#Field11-2').val(data.phone3);
    $('#Field4').val(data.address1);
    $('#Field5').val(data.address2);
    $('#Field6').val(data.city);
    $('#Field7').val(data.state);
    $('#Field8').val(data.zip);
    $('#Field13').val(data.text1);

    data.randomRadio($('[name="Field21"]'));

    // Randomize all select boxes
    $('select').each(function() {
      data.randomSelect(this);
    });

    // Randomize all checkboxes
    $('input[type="checkbox"').each(function() {
      data.randomCheckbox(this);
    });

    // Randomize all text areas
    $('textarea').each(function() {
      data.randomParagraph(this);
    });
  };
</code></pre>

Together all this code.  Closing remarks.

<h3>Demo</h3>

Embedded Pen here.


</article>
