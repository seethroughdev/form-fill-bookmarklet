<article>

<h1>Prefill Your Own Forms With A Bookmarklet</h1>

<p class="time">
  Published
  <time datetime="2013-06-13">
    June 13, 2013
  </time>
  by Guest Author
</p>

<em class="explanation">The following is a guest post by <a href="http://adamin.net/">Adam Lichtenstein</a>. Adam works at <a href="http://www.wufoo.com/">Wufoo</a>, a web app for building web forms, so you can imagine the need for testing forms is at least double what the rest of us need. Adam took a different road than <a href="http://css-tricks.com/prefill-forms-dev/">I took</a>, so I'll let him share.</em>

<!--more-->

Like most of you, I spend a good deal of time physically testing the user experience on my site.  Unit and integration tests are great,  but there's no easier way to find a pain-point on your site than to do it a thousand times.

With forms, this can get tedious, fast.

That's the situation I found myself in a couple of months ago when we were adding the British Pound to our checkout currencies in <a href="http://www.wufoo.com">Wufoo</a>.  I had multiple fields to fill out with names, emails, addresses, credit cards.  You name it.  And of course, a lot of the data had to be unique.

So I built a JavaScript Bookmarklet to help the team quickly fill in our checkout forms for testing.

I chose a JavaScript Bookmarklet because:

<ol>
  <li>I can distribute it quickly and easily</li>
  <li>I can push updates without the users having to do anything</li>
  <li>I can run them on any environment without changing the code</li>
</ol>

You can build and distribute a JavaScript Bookmarklet by just creating a Pen on CodePen and adding this snippet into an href:

<pre rel="HTML"><code markup="tt" class="language-markup"><a href="javascript: **js goes here** "></a></code></pre>

Your user only needs to drag the link into their bookmarks bar. Then click on it any time they want to run that code on the current page in the browser.

For this project, I'm going to lean on jQuery to keep the code lean and cross-browser friendly.  <em>If anyone wants the vanilla version, let me know in the comments and I'll be happy to put something together.</em>

I also want to insert random data for most of the fields, so I'm going to use a great library out there called <a href="https://github.com/stympy/faker">Faker</a>. We'll use <a href="https://github.com/marak/Faker.js/">the JavaScript implementation</a> here.

<h3>Building the Bookmarklet</h3>

We could put our code directly into the snippet.  But besides being cleaner and more maintainable, we want to be able to update that code without being forced to update the actual bookmarklet.  So instead, lets reference an external file.

We'll start with our snippet code:

<pre rel="HTML"><code markup="tt" class="language-markup"><a href="javascript:
(function(d) {
  var body = d.getElementsByTagName('body')[0],
      script = d.createElement('script');
      script.src = '//localhost.com/pathtomyfile.js';
      body.appendChild(script);
}(window.document));
">My Javascript Bookmarklet</a></code></pre>

We're using JavaScript to append a <code>script</code> tag to the <code>body</code>, and adding the path to our file inside. <strong>If you are testing on an https secure page, you will want to make sure your script is also https.  Otherwise some browsers will throw a security error.</strong>

<em>Note: You'll probably use a localhost version of the file while you're in development and replace it with a production version when you're ready to share.</em>

<h3>The Prefilling Script</h3>

Now that we have our bookmarklet ready to load a script file of our choice.  Lets make that script file...

First we'll wrap the whole thing in a <a href="#">Self Invoking Anonymous Function</a>.  That will help make sure our code doesn't pollute anything on the outside.

Basically, it just protects the variables created inside of it.  While at the same time, executes directly on load.

<pre rel="Javascript">
<code markup="tt" class="language-javascript">(function(win, doc, $, undefined) {
    'use strict';

    // Don't run if jQuery isn't loaded
    if (typeof window.jQuery === 'undefined') {
      return;
    }

    // Our code will go here.

  }(window, window.document, window.jQuery));
</code></pre>

I like Chris's randomize function.  Let's use it in our script.

<pre rel="Javascript"><code markup="tt" class="language-javascript">var _rand = function(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
</code></pre>

Next, lets load up the FakerJS script.  Since we've decided we'll use jQuery as a dependency.  We can just use $.getScript which will return a <a href="#">jQuery promise</a> when its done.

<pre rel="Javascript"><code markup="tt" class="language-javascript">$.getScript('//cdnjs.cloudflare.com/ajax/libs/Faker/0.7.2/MinFaker.js')
    .done(function() {
      // run our functions from here
    })
    .fail(function() {
      win.console.error('ERROR: FakerJS not loaded!');
    });
</code></pre>

Instead of just creating literal data.  Lets make a <a href="#">constructor function</a> that we can reuse if necessary in the future.

<pre rel="Javascript"><code markup="tt" class="language-javascript">var FormData = function(faker) {

    this.faker     = faker;

    this.randomWord = faker.Internet.domainWord();

    this.username  = 'fake_' + this.randomWord;
    this.username  += _rand(100,9999);

    // set this value to your password specifications
    this.password  = 'pass1234';

    this.name      = faker.Name.findName();

    this.address1  = faker.Address.streetAddress();
    this.city      = faker.Address.city();
    this.state     = faker.random.br_state_abbr();
    this.zip       = faker.Address.zipCode();

    // Chris's actual credit card number
    this.cc        = '4242 4242 4242 4242';
    this.exp1      = _rand(1,12);
    this.exp2      = _rand(14,22);
    this.cvv       = _rand(100,999);

  };
</code></pre>

I'd like to make certain field types like checkboxes and select boxes random.  So lets extend the FormData object with some functions.

<pre rel="jQuery"><code markup="tt" class="language-javascript">
  // Select random Dropdowns
 FormData.prototype.randomizeSelect = function(el) {
    var $el  = $(el),
        len  = $el.find('option').length - 1;

    $el.children('option')
      .prop('selected', false)
      .eq( _rand( 1,len + 1 ) )
      .prop('selected', true);
  };

  FormData.prototype.randomizeRadio = function(radios) {
    radios  = radios.not('[type="hidden"]');
    var len = radios.length;

    radios
      .prop('checked', false)
      .eq( _rand( 0, len - 1 ) )
      .prop('checked', true);
  };

  FormData.prototype.randomizeParagraph = function(el) {
    $(el).val(this.faker.Lorem.sentence(5));
  };

  FormData.prototype.randomizeCheckbox = function(el) {
    var $el  = $(el);

    $el.prop('checked', false);

    if (_rand( 0,1 ) === 0) {
      $el.prop('checked', true);
    }
  };

  FormData.prototype.randomizeEmail = function(el) {
    $(el).val('chriscoyier+' + this.randomWord + '@gmail.com');
  };

</code></pre>

And last, we just need to bind the data to the fields on our form.

<pre rel="Javascript"><code markup="tt" class="language-javascript">var fillForm = function() {
    data = new FormData(window.Faker);

    $('#name').val(data.name);
    $('#username').val(data.username);
    $('#cc').val(data.cc);
    $('#exp-1').val(data.exp1);
    $('#exp-2').val(data.exp2);
    $('#cvv').val(data.cvv);
    $('#address').val(data.address1);
    $('#city').val(data.city);
    $('#state').val(data.state);
    $('#zip').val(data.zip);
    $('#pw').val(data.password);
    $('#pw-repeat').val(data.password);

    data.randomizeRadio($('[name="radio-choice"]'));

    // Randomize all emails
    $('input[type="email"').each(function() {
      data.randomizeEmail(this);
    });

    // Randomize all select boxes
    $('select').each(function() {
      data.randomizeSelect(this);
    });

    // Randomize all checkboxes
    $('input[type="checkbox"').each(function() {
      data.randomizeCheckbox(this);
    });

    // Randomize all textareas
    $('textarea').each(function() {
      data.randomizeParagraph(this);
    });
  };
</code></pre>

You could also call <code>submit</code> on the form at the end to automatically send the data if you wanted.  It's just a matter of preference.

<pre rel="Javascript"><code markup="tt" class="language-javascript">$('#form').submit();</code></pre>

<h3>Conclusion</h3>

That's about all it takes to get a quick and dirty random data form filler in a javascript bookmarklet.

There's definitely a few ways we could improve on this.  But when you're in a time crunch.  It can definitely do the trick.

If you want to see another javascript bookmarklet I made for <a href="https://www.surveymonkey.com/">SurveyMonkey</a> and open sourced.  Check out <a href="https://seethroughtrees.github.io/nice-inline-copy-editor/">Inline Copy Editor</a>.

</article>
